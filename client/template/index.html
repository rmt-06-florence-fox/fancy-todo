<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-signin-client_id" content="1052799407511-50jorihbhk0g4jgimq1npit96ulbg0oj.apps.googleusercontent.com">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>    
<!-- Navbar HomePage -->
<div id="navbar-custom">
    <div class="navbar-custom">
        <div class="logo-navbar mt-2">
            <img src="./assets/Screenshot from 2020-12-06 21-59-00.png" alt="logo" width="170px">
        </div>
        <div>
            <ul class="center-navbar mt-1">
                <li><a id="home" href="#">Home</a></li>
                <li><a id="infoApp" href="#">Info App</a></li>
                <li><a href="#">Help</a></li>
            </ul>
        </div>
        <div>
            <ul class="right-navbar mt-1">
              <li><button id="buttonLogin" type="button" class="btn btn-outline-primary text-light">Login</button></li>
              <li><button id="buttonRegister" type="button" class="btn btn-primary">Register</button></li>
            </ul>
        </div>
    </div>
</div>

<!-- Navbar LandingPage -->
<div id="landing-page">
  <div class="mt-5 bg">
      <br>
      <br>
      <div class="mx-auto text-center">
          <h1>Welcome to My Todo Application</h1>
      </div>
      <br>
      <br>
      <div class="text-center">
          <h4>This application helps you to make people organized to carry out daily activities.</h4>       
          <h5>To start, you can <b>Regiter</b> first or if you already have an account you can select <b>Login button</b></h5>
      </div>
  </div>
</div>

<!-- Form Login -->
<div id="pageLogIn">
  <div class="d-flex bg">
      <div class="mx-auto mt-5">
          <div class="shadow p-3 mb-5 bgS rounded mx-auto mt-4">
              <div class="text-center">
                  <h2>Application My Todo</h2>
              </div>
              <form id="formLogin">
                  <div class="form-group row">
                      <div class="mx-auto mt-2">
                          <label for="emailLogIn" class="col-sm-2 col-form-label">Email:</label> <br>
                      </div>
                      <div class="col-sm-10 mx-auto">
                          <input type="email" class="form-control" id="emailLogIn">
                      </div>
                  </div>
                  <div class="form-group row">
                      <div class="mx-auto mt-2">
                          <label for="inputPassword3" class="col-sm-2 col-form-label">Password:</label> 
                      </div> 
                      <div class="col-sm-10 mx-auto">
                          <input type="password" class="form-control" id="passwordLogIn">
                      </div>
                  </div>
                  <div class="form-group row">
                      <div class="mx-auto">
                          <button type="submit" class="btn btn-primary">Login</button>
                      </div>
                  </div>
              </form>
              <div class="g-signin2" data-onsuccess="onSignIn"></div>
              <!-- <div class="g-signin2" data-onsuccess="onSignIn"></div> -->
          </div>
      </div>         
  </div>
</div>

<!-- Page Help -->
<div id="page-help">
  <div class="bg">
      <div class="container mt-5 colHelpCard">
          <h4>Getting Started</h4>
          <div class="row mt-4">
              <div class="col-4">
                  <div class="shadow p-3 mb-5 bg-white rounded helpCard text-center">
                      <img src="./assets/undraw_mobile_payments_vftl.png" alt="regist" width="130px">
                      <h5>1. Register</h5>
                  </div>
              </div>
              <div class="col-4">
                  <div class="shadow p-3 mb-5 bg-white rounded helpCard text-center">
                      <img src="./assets/undraw_Login_re_4vu2.png" alt="login" width="205px">
                      <h5>2. Log In</h5>
                  </div>
              </div>
              <div class="col-4">
                  <div class="shadow p-3 mb-5 bg-white rounded helpCard text-center">
                      <img src="./assets/undraw_To_do_list_re_9nt7.png" alt="todoList" width="220px">
                      <h5>3. Create your Todo</h5>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- Form Registrasi -->
<div id="pageRegister">
  <div class="d-flex bg">
      <div class="mx-auto mt-2">
          <div class="shadow p-3 mb-5 bgS rounded mx-auto mt-4">
              <div class="text-center">
                  <h2>Application My Todo</h2>
              </div>
              <div class="mt-4">
                  <!-- FORM REGISTER -->
                  <form id="registerForm">
                      <div class="form-row">
                        <div class="form-group col-md-6">
                          <label for="inputEmail4">First Name</label>
                          <input type="text" class="form-control" id="first-name-register">
                        </div>
                        <div class="form-group col-md-6">
                          <label for="inputPassword4">Last Name</label>
                          <input type="text" class="form-control" id="last-name-registrasi">
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="inputEmail4">Email</label>
                        <input type="email" class="form-control" id="inputEmail4">
                      </div>
                      <div class="form-group">
                        <label for="inputPassword4">Password</label>
                        <input type="password" class="form-control" id="inputPassword4">
                      </div>
                      <div class="form-group row buttonRegistrsai">
                          <div class="mx-auto">
                              <button type="submit" class="btn btn-primary">Register</button>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
      </div>
  </div>
</div>

    <!-- Navbar MainPage -->
<nav class="navbar navbar-expand-lg navbar-light bg-light" id="navbar-after-login">
    <img src="./assets/output-onlinepngtools.png" alt="logo" width="130" height="40">
    <button class="navbar-toggler my-auto" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarText">
      <section>
              <button type="button" class="btn btn-danger" id="logOut">Log Out</button>
      </section>
    </div>
</nav>


<div class="container">
<!-- Home Page -->
      <section id="homePage">
          <hr>
          <button class="btn btn-primary" id="buttonAddTodo">
              Add Todo
          </button>
          <hr>
          <Section id="cardTodo">
            
          </Section>
      </section>
          <!-- Add Form -->
      <div id="formAdd">
        <br> <br>
          <h3 class="justify-content-center">Add Form</h3> <br>
              <form id="addForm">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Title</label>
                    <input type="text" class="form-control" id="addTitle" aria-describedby="emailHelp">
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">Description</label>
                    <input type="text" class="form-control" id="addDesc">
                  </div>
                    <div class="form-group">
                      <label for="exampleInputEmail1">Due Date</label>
                      <input type="date" class="form-control" id="addDueDate" aria-describedby="emailHelp">
                    </div>
                  <button type="submit" class="btn btn-primary">Submit</button>
                  <a href="#" id="backFromAddData">Back</a>
                </form>
      </div>

      <div id="formEdit">
        <br> <br>
          <h3 class="justify-content-center">Add Form</h3> <br>
              <form id="addForm">
                  <div class="form-group">
                    <label for="exampleInputEmail1">Title</label>
                    <input type="text" class="form-control" id="addTitle" aria-describedby="emailHelp">
                  </div>
                  <div class="form-group">
                    <label for="exampleInputPassword1">Description</label>
                    <input type="text" class="form-control" id="addDesc">
                  </div>
                    <div class="form-group">
                      <label for="exampleInputEmail1">Due Date</label>
                      <input type="date" class="form-control" id="addDueDate" aria-describedby="emailHelp">
                    </div>
                  <button type="submit" class="btn btn-primary">Submit</button>
                  <a href="#" id="backFromAddData">Back</a>
                </form>
      </div>
</div>
    
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
function hideAll () {
  $("#pageRegister").hide()
  $("#pageLogIn").hide()
  $("#logOut").hide()
  $("#navbar-after-login").hide()
  $("#formAdd").hide()
  $("#formEdit").hide()
  $("#homePage").hide()
  $("#navbar-homePage").hide()
  $("#page-help").hide()
  $("#navbar-after-login").hide()
  $("#landing-page").hide()
  $("#navbar-homePage").hide() 
  $("#navbar-custom").hide()
}

function LandingPage () {
  hideAll()
  $("#navbar-custom").show()
  $("#landing-page").show()
}

function home () {
  hideAll()
  $("#navbar-custom").show()
  $("#landing-page").show()
  
}

function showLogIn() {
  hideAll ()
  $("#pageLogIn").show()
  $("#navbar-custom").show()    
}

function showRegister() {
  hideAll()
  $("#pageRegister").show()
  $("#navbar-custom").show()  
}

function showMainPage() {
  hideAll()
  $("#logOut").show()
  $("#navbar-after-login").show()
  $("#homePage").show()
  getTodo()
}
       
function showFormAdd() {
  hideAll()
  $("#logOut").show()
  $("#formAdd").show()
  $("#navbar-after-login").show()
  $("#backFromAddData").show()
  $("#backFromAddData").on("click", () => {
    showMainPage()
  })
}

function collectionInputFromRegister() {
  const payload = {
      firstName: $("#first-name-register").val(),
      lastName: $("#last-name-registrasi").val(),
      email: $("#inputEmail4").val(),
      password: $("#inputPassword4").val()
  }
  return payload
}
  
function collectionInputFromLogIn() {
    let objLogIn = {
        email: $("#emailLogIn").val(),
        password: $("#passwordLogIn").val()
    }
    return objLogIn
}

function register(event) {
  event.preventDefault()
  $.ajax({
    method: "POST",
        url: "http://localhost:3000/register",
        data: payload
    })
    .done(res => {
        console.log(res)
    })
    .fail((err) => {
        console.log(err)
    })
}

function logOut() {
  hideAll()
  localStorage.clear()
  $("#navbar-custom").show()
  $("#pageLogIn").show()
}

function formEditTodo() {
  hideAll()
  $("#navbar-after-login").show()
  $("#formEdit").show()
}

function getTodo() { 
  $.ajax ({
    url: "http://localhost:3000",
    method: "GET",
    headers: {
      accestoken: localStorage.getItem("acces_token")
    }
  })
    .done(response => {
      let dataTodos = response.data
        $("#cardTodo").empty() // setiap read jangan lupa di kosongin dulu biar ga numpuk
        
          dataTodos.forEach(el => {
            if(el.status === "uncomplate") {
              $("#cardTodo").append(`
              <div class="card mb-5">
                <div class="card-header">
                  Todo
                </div>
                <div class="card-body">
                  <h5 class="card-title">${el.title}</h5>
                  <p class="card-text">${el.description}</p>
                  <a href="#" class="btn btn-primary" onclick="editTodo(${el.id})">Edit</a>
                  <a href="#" class="btn btn-primary" onclick="deleteTodo(${el.id})">Delete</a>
                  <a href="#" class="btn btn-primary" onclick="editStatus(${el.id})">Complate</a>
                </div>
              </div>
              `)
            }else {
              $("#cardTodo").append(`
                <div class="card mb-5">
                  <div class="card-header">
                    Todo
                  </div>
                  <div class="card-body bg-secondary text-light">
                    <h5 class="card-title">${el.title}</h5>
                    <p class="card-text">${el.description}</p>
                    <a href="#" class="btn btn-primary" onclick="editTodo(${el.id})">Edit</a>
                    <a href="#" class="btn btn-primary" onclick="deleteTodo(${el.id})">Delete</a>
                    <a href="#" class="btn btn-primary" onclick="editStatus(${el.id})">Complate</a>
                  </div>
                </div>
            `)
            }
          })
    })
    .fail(err => {
        console.log(err)
    })
}

function createTodo() {
  let objTodo = {
    title: $("#addTitle").val(),
    description: $("#addDesc").val(),
    status: "uncomplate",
    due_date: $("#addDueDate").val()
  }
    // console.log(collectionInputFormAddTodo())
  $.ajax({
    url: "http://localhost:3000",
    method: "POST",
    headers: {
      accestoken: localStorage.getItem("acces_token")
    },
    data: objTodo
  })
    .done(response => {
      showMainPage()
      
    })
    .fail(err => {
    })
    .always(() => {
      $("#addTitle").val(""),
      $("#addDesc").val(""),
      $("#addDueDate").val("")
  })
}

function deleteTodo(id) {
  // console.log(id)
  $.ajax({
    url: `http://localhost:3000/${id}`,
    method: "DELETE",
    headers: {
        accestoken: localStorage.getItem("acces_token")
    }
  })
    .done(response => {
      showMainPage()
    })
    .fail(err => {
      console.log(err)
    })
}

function editTodo(id) {
  // console.log(id)
  $("#formEdit").show()
  $.ajax({
    url: "http://localhost:3000/"+id,
    method: "GET",
    headers: {
      accestoken: localStorage.getItem("acces_token")
    }
  })
    .done(({ data }) => {
      console.log(data)
      formEditTodo()
      $("#formEdit").append(`
      <br>
      <h3 class="justify-content-center">Edit Form</h3>
          <form id="editForm" onsubmit="saveDataEdit(event, ${data.id}), ${data.status}">
              <div class="form-group">
                <label for="exampleInputEmail1">Title</label>
                <input type="text" class="form-control" id="inputTitleEdit" aria-describedby="emailHelp" value="${data.title}">
              </div>
              <div class="form-group">
                <label for="exampleInputPassword1">Description</label>
                <input type="text" class="form-control" id="inputDescEdit" value="${data.description}">
              </div>
                <div class="form-group">
                  <label for="exampleInputEmail1">Due Date</label>
                  <input type="date" class="form-control" id="inputDueDateStatus" aria-describedby="emailHelp" value="${data.due_date}">
                </div>
              <button type="submit" class="btn btn-primary">Submit</button>
              <a href="#" id="backFromAddData">Back</a>
            </form>
      `)
      $("#backFromAddData").on("click", () => {
        showMainPage()
      })
      
    })
    .catch(err => {
      console.log(err)
    })
}

function editStatus(id) {
  let status = "complete"
  $.ajax({
    url: "http://localhost:3000/"+id,
    method: "PATCH",
    headers: {
      accestoken: localStorage.getItem("acces_token")
    },
    data: {
      status
    }
  })
    .done(response => {
      showMainPage()
    })
    .fail(err => {
      console.log(err)
    })
}

function onSignIn(googleUser) {
  var googleToken = googleUser.getAuthResponse().id_token;
  $.ajax({
    url: `http://localhost:3000/googlelogin`,
    method: "POST",
    data: {
      googleToken
    }
  })
    .done((response) => {
      console.log(response)
        localStorage.setItem('acces_token', response.accestoken);

        showMainPage()
    })

    .fail((jqxhr, status) => {
        console.log(jqxhr.responseJSON);
    })

    .always(() => {
        $("#emailLogIn").val("")
        $("#passwordLogIn").val("")
    })
}
  
function saveDataEdit(event, id, statusDataBase) {
  event.preventDefault()
  $("#editForm").on("submit", () => {
    let title = $("#inputTitleEdit").val()
    let description = $("#inputDescEdit").val()
    let status = statusDataBase
    let due_date = $("#inputDueDateStatus").val() 

    $.ajax({
      url: "http://localhost:3000/"+id,
      method: "PUT",
      headers: {
        accestoken: localStorage.getItem("acces_token")
      },
      data: {
        title,
        description,
        status,
        due_date
      }
    })
      .done(response => {
        showMainPage()
      })
      .fail(err => {
        console.log(err)
      })
  })
  
}

$(document).ready(function(){ 
  if(localStorage.getItem("acces_token")) {
      showMainPage()
  }else {
      LandingPage()
  }
  
  $("#formLogin").on("submit", (event) => {
    event.preventDefault()
    // console.log(collectionInputFromLogIn())
    $.ajax({
        url: "http://localhost:3000/login",
        method: "POST",
        data: collectionInputFromLogIn()
    })
      .done(response => {
          const acces_token = response.accesToken
          localStorage.setItem("acces_token", acces_token)                   
          showMainPage()
      })
      .fail((xhr, textStatus) => {
          console.log(xhr, textStatus)
      })
      .always(() => { // untuk mengosongkan, jangan lupa dikosongkan dengan cara ini
        $("#emailLogIn").val(""),
        $("#passwordLogIn").val("")
      })
  })

  $("#registerForm").on("submit", (event) => {
    event.preventDefault()
    // console.log(collectionInputFromLogIn())
    console.log(collectionInputFromRegister())
    $.ajax({
        url: "http://localhost:3000/register",
        method: "POST",
        data: collectionInputFromRegister()
    })
      .done(response => {                   
        showLogIn()
      })
      .fail((xhr, textStatus) => {
          console.log(xhr, textStatus)
      })
      .always(() => { // untuk mengosongkan, jangan lupa dikosongkan dengan cara ini
        $("#emailLogIn").val(""),
        $("#passwordLogIn").val("")
      })
  })
      
  $("#logOut").on("click", () => {
    logOut()
    var auth2 = gapi.auth2.getAuthInstance();
    auth2.signOut().then(function () {
      console.log('User signed out.');
    })
  })

      // Tombol Ke Register
  $("#buttonRegister").on("click", () => {
      showRegister()
  })

  $('#buttonLogin').on("click", () => {
      showLogIn()
  })
      // Tombol Back Ke log In
  $("#backLogin").on("click", () => {
      showLogIn()
  })

  $("#buttonAddTodo").on("click", (event) => {
    event.preventDefault()
    showFormAdd()
  })

    $("#addForm").on("submit", (event) => {
      event.preventDefault()
      createTodo()
    })
});
         
</script>
</body>
</html>