<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <title>Document</title>
</head>



<body>
  <!-- navbar -->
  <div id=navbar-container>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Fancy Todo</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
          </li>
        </ul>
        <button class="btn btn-outline-success my-2 my-sm-0" id="sign-out-button" onclick="logout()">Sign Out</button>
      </div>
    </nav>
  </div>
  <!-- login -->
  <div id="login-page">
    <div class="container p-5">
      <form id="login-form">
        <div class="form-group">
          <label for="inputEmail">Email</label>
          <input type="email" id="inputEmail" class="form-control">
        </div>
        <div class="form-group">
          <label for="inputPassword">password</label>
          <input type="password" id="inputPassword" class="form-control">
        </div>
        <input type="submit" id="submit-login" value="login">
      </form>
      <a href="" id="link-register">register</a>
    </div>
  </div>
  <!-- register -->
  <div id="register-page">
    <div class="container p-5">
      <form id="register-form">
        <div class="form-group">
          <label for="inputEmail">Email</label>
          <input type="email" id="inputEmailRegister" class="form-control">
        </div>
        <div class="form-group">
          <label for="inputPassword">password</label>
          <input type="password" id="inputPasswordRegister" class="form-control">
        </div>
        <input class="btn btn-primary" type="submit" id="submit-register" value="register">
      </form>
    </div>
  </div>
  <div id="main-page">
    <h1>ini main page</h1>
  </div>

  <div id="create-todo">
    <h1>ini create-todo</h1>
  </div>



  <script src="http://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script>
    function showLogin() {
      $('#login-page').show();
      $('#main-page').hide();
      $('#create-todo').hide();
      $('#sign-out-button').hide();
      $('#register-page').hide();
    }
    function showMainPage() {
      $('#login-page').hide();
      $('#main-page').show();
      $('#create-todo').show();
      $('#sign-out-button').show();
      $('#register-page').hide();
    }
    function showRegister(){
      $('#login-page').hide();
      $('#main-page').hide();
      $('#create-todo').hide();
      $('#sign-out-button').hide();
      $('#register-page').show();
    }

    function login() {
      const email = $('#inputEmail').val()
      const password = $('#inputPassword').val()
      console.log(email, password);

      $.ajax({
        method: "POST",
        url: "http://localhost:3000/login",
        data: {
          email,
          password
        }
      })
        .done((response) => {
          console.log(response);
          localStorage.setItem('access_token', response.access_token)
          console.log(localStorage.getItem('access_token'));
          showMainPage();
        })
        .fail((xhr, textStatus) => {
          console.log(xhr.responseJSON);
        })
        .always(_ => {
          $('#inputEmail').val("")
          $('#inputPassword').val("")
        })
    }

    function logout() {
      localStorage.removeItem("access_token");
      showLogin();
    }

    function register(){
      const email = $('#inputEmailRegister').val()
      const password = $('#inputPasswordRegister').val()
      console.log(email,password);
      $.ajax({
        method:"POST",
        url:"http://localhost:3000/register",
        data:{
          email,
          password
        }
      })
      .done(_=>{
        showLogin()
      })
      .fail((xhr, textStatus)=>{
        console.log(xhr);
      })
      .always(_=>{
        $('#inputEmailRegister').val("")
        $('#inputPasswordRegister').val("")
      })
    }

    function checkToken(){
      (localStorage.getItem('access_token'))? true:false
    }

    $(document).ready(() => {
      if (checkToken()) {
        showMainPage();
      } else {
        showLogin();
      }

      $('#login-form').on('submit', (e) => {
        e.preventDefault()
        login()
      })

      $('#link-register').on('click',(e)=>{
        e.preventDefault();
        showRegister();
      })

      $('#register-form').on('submit', (e)=>{
        e.preventDefault();
        register();
      })
      
    })
  </script>
</body>

</html>